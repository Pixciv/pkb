name: 🏗️ Build APK

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: 📥 Repo klonla
      uses: actions/checkout@v3

    - name: 🧰 Gerekli paketleri kur (jq, imagemagick, openjdk)
      run: |
        sudo apt-get update
        sudo apt-get install -y jq imagemagick openjdk-17-jdk

    - name: ☕ Java versiyon kontrol
      run: java -version

    - name: 🛡️ Gradle Wrapper’a izin ver
      run: chmod +x ./gradlew

    - name: 🛠️ Build scriptine izin ver
      run: chmod +x ./build.sh

    - name: 🚀 Build işlemini başlat
      run: ./build.sh

    - name: 🧭 🔗 Debug APK yolu alınıyor
      id: debug
      run: echo "path=$(cat release-debug.txt)" >> $GITHUB_OUTPUT

    - name: 🧭 🔗 Release APK yolu alınıyor
      id: release
      run: echo "path=$(cat release-release.txt)" >> $GITHUB_OUTPUT

    - name: 🧭 🔗 AAB dosya yolu alınıyor
      id: aab
      run: echo "path=$(cat release-aab.txt)" >> $GITHUB_OUTPUT

    - name: 📦 Yükle - Debug APK
      uses: actions/upload-artifact@v4
      with:
        name: debug-apk
        path: ${{ steps.debug.outputs.path }}

    - name: 📦 Yükle - Release APK
      uses: actions/upload-artifact@v4
      with:
        name: release-apk
        path: ${{ steps.release.outputs.path }}

    - name: 📦 Yükle - Release AAB
      uses: actions/upload-artifact@v4
      with:
        name: release-aab
        path: ${{ steps.aab.outputs.path }}
